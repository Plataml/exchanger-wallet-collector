# Архитектура проекта

## Компоненты

- **config.ts** - загрузка конфигурации из .env
- **db.ts** - работа с SQLite (exchangers, wallets, attempts)
- **browser.ts** - Playwright браузер с поддержкой прокси и CDP
- **collector.ts** - основная логика сбора адресов
- **captcha.ts** - детектирование и решение капч через 2captcha
- **telegram.ts** - уведомления об успехах и ошибках

## Движки (engines/)

Система автоматически определяет тип сайта и применяет нужный движок:

- **vue-spa.ts** - Vue.js SPA обменники (большинство)
- **multipage.ts** - Многостраничные формы
- **base.ts** - Базовые паттерны и утилиты
- **detector.ts** - Детектор типа обменника

## Схема работы

```
1. Загрузка списка активных обменников из БД
2. Для каждого обменника:
   a. Запуск браузера (Playwright или CDP к антидетекту)
   b. Переход на сайт обменника с параметрами валюты
   c. Определение типа движка (Vue SPA / Multipage)
   d. Заполнение формы через движок или JSON-адаптер
   e. Решение капчи если есть (2captcha)
   f. Извлечение депозитного адреса
   g. Сохранение скриншота
   h. Запись в БД
   i. Telegram уведомление
   j. Случайная задержка (30-120 сек)
3. Повтор цикла
```

## Обход защиты

1. **Антидетект браузер** - CDP подключение (Multilogin/GoLogin)
2. **2captcha** - reCAPTCHA v2/v3, hCaptcha, Turnstile
3. **Резидентные прокси** - ротация IP

## Формат данных

### exchangers.json

```json
[
  {"name": "ExchangerName", "domain": "exchanger.com"}
]
```

### База данных

- **exchangers** - список обменников
- **wallets** - собранные адреса со скриншотами
- **attempts** - лог попыток (success/failed/captcha/blocked)
